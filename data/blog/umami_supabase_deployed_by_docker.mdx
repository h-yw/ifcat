---
title: ä½¿ç”¨ umami + supabase éƒ¨ç½²è‡ªå·±çš„ç½‘ç«™ç»Ÿè®¡å¹³å°
date: 2024-12-14
tags: [docker, æŠ€æœ¯æµ]
draft: false
keywords: [umamiéƒ¨ç½², supabaseä½¿ç”¨, ç½‘ç«™æ•°æ®ç»Ÿè®¡, è‡ªå»ºç½‘ç«™ç»Ÿè®¡ï¼Œumami+supabase]
summary: ä»Šå¤©å°±è®²ä¸€ä¸‹å¦‚ä½•åœ¨ docker ä¸­éƒ¨ç½² umamiï¼Œä»¥åŠé‡åˆ°çš„å‘ã€‚umami çš„æ•°æ®åº“ç›´æ¥ä½¿ç”¨ supabase æä¾›çš„å…è´¹èµ„æºã€‚
---

## å‰è¨€

&emsp;&emsp;ä»Šå¤©å°±è®²ä¸€ä¸‹å¦‚ä½•åœ¨ docker ä¸­éƒ¨ç½² [umami](https://umami.is/)ï¼Œä»¥åŠé‡åˆ°çš„å‘ã€‚umami çš„æ•°æ®åº“ç›´æ¥ä½¿ç”¨[supabase](https://supabase.com)æä¾›çš„å…è´¹èµ„æºã€‚

<TOCInline toc={props.toc} exclude="Overview" toHeading={3} />

## å‡†å¤‡å·¥ä½œ

### åœ¨ [supabase](https://supabase.com) ä¸­åˆ›å»ºä¸€ä¸ªé¡¹ç›®

&emsp;&emsp;å…è´¹ç”¨æˆ·ä¸€ä¸ªç»„ç»‡åªèƒ½å»ºä¸¤ä¸ªé¡¹ç›®ï¼Œæˆ‘å·²ç»æ»¡äº†ã€‚æ‰€ä»¥......æˆªå›¾æ²¡æœ‰äº†å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆã€‚

&emsp;&emsp;åˆ›å»ºå®Œé¡¹ç›®ä»¥åï¼Œåœ¨connectä¸­å°±èƒ½çœ‹åˆ°æ•°æ®åº“çš„è¿æ¥ä¿¡æ¯ã€‚

![alt](/static/posts/supabase-connect.png)

> [!WARNING/æ³¨æ„]
> åˆ‡è®°é€‰æ‹© **Transaction pooler** è¿™ä¸ª URI å•Šï¼Œå¦åˆ™å°±è¿ä¸ä¸Šæ•°æ®åº“äº†ï¼

### å‡†å¤‡ docker compose æ–‡ä»¶

```yaml
version: '3'
services:
  umami:
    image: umamisoftware/umami:postgresql-latest
    ports:
      - '9099:9099'
    environment:
      DATABASE_URL: postgresql://postgres.[project-id]:[password]@aws-0-ap-southeast-1.pooler.supabase.com:5432/[database] # è¿™é‡Œçš„è¿æ¥ä¿¡æ¯,passwordå°±æ˜¯åœ¨supabaeç»„ç»‡å†…æ–°å»ºé¡¹ç›®æ—¶è®¾ç½®çš„
      DATABASE_TYPE: postgresql
      APP_SECRET: 'è®¾ç½®è‡ªå·±çš„éšæœºå€¼å°±okayäº†'
      PORT: 9099
    restart: always
volumes:
  umami-db-data:
```

> [!TIP/å°è´´å£«]
> å›½å†…æœåŠ¡å™¨æ— æ³•è®¿é—®dockeré•œåƒï¼Œå¯ä»¥ä¿®docker composeæ–‡ä»¶ï¼š
> `image: docker.umami.is/umami-software/umami:postgresql-latest`

## åŸç¥å¯åŠ¨(ä¸æ˜¯ğŸ˜…)

&emsp;&emsp; `docker-compose.yml`ä¸‹æ‰§è¡Œå‘½ä»¤

```bash
docker-compose up -d
```

&emsp;&emsp; è¿™å°±å®Œäº‹äº†... ç„¶åè¿˜è¦ä½¿ç”¨nginxåšåå‘ä»£ç†ï¼Œè®²åŸŸåæŒ‡å‘dockerçš„ipåœ°å€ï¼Œç«¯å£å°±æ˜¯**docker-compose.yml**ä¸­çš„æ˜ å°„åœ°å€ä¹‹**9099**ã€‚

&emsp;&emsp; ç”±äºæˆ‘ä½¿ç”¨äº†nginx proxy manageræ¥ç®¡ç†nginxï¼Œæ‰€ä»¥ç›´æ¥åœ¨nginx proxy managerä¸­æ·»åŠ ä¸€ä¸ªä»£ç†ï¼Œç„¶åå°±okäº†ã€‚æ‰€ä»¥...è¿™é‡Œä¹Ÿæ²¡æœ‰nginxçš„é…ç½®äº†ğŸ˜…

![nginx proxy manageré…ç½®](/static/posts/proxy-9099.png)

## æµ‹è¯•

&emsp;&emsp; å®ŒæˆåŸŸåé…ç½®ä»¥åï¼Œå°±å¯ä»¥çœ‹åˆ°ä½ çš„ç½‘ç«™ç»Ÿè®¡äº†ã€‚æ‰“å¼€åå°±æ˜¯ç™»å½•é¡µé¢äº†ã€‚ç„¶åå°±ç™»å½•è‡ªå·±æ…¢æ…¢ç©å§ğŸ¤­ã€‚

```toml:é»˜è®¤è´¦å·å¯†ç 
è´¦å·: admin
å¯†ç : umami
```

![umami](/static/posts/umami-login.png)

## é‡åˆ°çš„å‘

&emsp;&emsp; <span style={{fontWeight:"bold",color:"red"}}>ä¸€ä¸ªå·¨å‘ï¼ï¼ï¼</span>

&emsp;&emsp; ç”±äºæˆ‘çš„ nginx proxy manager ä¹Ÿæ˜¯ docker éƒ¨ç½²çš„ï¼Œnginx å®åœ¨ docker ä¸­ï¼Œæ‰€ä»¥ umami çš„ docker æœåŠ¡ ip éœ€è¦å’Œ nginx çš„ docker æœåŠ¡ ip åœ¨ä¸€ä¸ªç½‘æ®µï¼Œä¸€ä¸ªç½‘æ®µï¼Œä¸€ä¸ªç½‘æ®µã€‚ã€‚ã€‚

&emsp;&emsp; å°±æ˜¯è¯´ï¼Œ**nginx proxy manager åœ¨ 172.17.0.\* ip æ®µä¸‹çš„è¯ï¼Œumami çš„ docker æœåŠ¡å°±åªèƒ½åœ¨172.17.0.\* ip æ®µä¸‹ã€‚** å¦åˆ™æŠ¥504ç½‘å…³è¶…æ—¶å•Šæœ‹å‹ä»¬ï¼ğŸ˜­

## æ€»ç»“

&emsp;&emsp; æ€»ç»“å°±æ˜¯ï¼Œumami çš„ docker æœåŠ¡å’Œ nginx proxy manager åœ¨åŒä¸€ä¸ªç½‘æ®µä¸‹ï¼Œå¦åˆ™å°±æ— æ³•è®¿é—®ã€‚

&emsp;&emsp; dockeré•œåƒå›½å†…æœåŠ¡å™¨è®¿é—®ä¸äº†ï¼Œå¾ˆå¤šä¸‰æ–¹é•œåƒéƒ½æŒ‚äº†ï¼Œæœ‰å…´è¶£å¯ä»¥ç”¨cloudflare pageså’Œ[CF-Workers-docker](https://github.com/cmliu/CF-Workers-docker.io)è‡ªè¡Œæ­å»º

&emsp;&emsp; ä¹Ÿå¯ä»¥ä½¿ç”¨vercelså¿«é€Ÿæ­å»ºï¼Œåªéœ€forkä¸€ä¸‹umamiçš„ä»“åº“ï¼Œç„¶åå†vercelsä¸Šå»ºä¸€ä¸ªé¡¹ç›®ï¼Œä½¿ç”¨forkçš„ä»“åº“ï¼Œé…ç½®docker-compose.ymlä¸­environmentå˜é‡å³å¯(PORTä¸éœ€è¦)ã€‚

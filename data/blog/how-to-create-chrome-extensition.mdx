---
title: ä½¿ç”¨vite+reactå¼€å‘ä¸€ä¸ªChromeæ’ä»¶
date: 2024-10-14
tags: [Chromeæ’ä»¶, Vite, React]
keywords: [Chromeæ’ä»¶å¼€å‘, Chrome æ‰©å±•å¼€å‘æ•™ç¨‹, Vite + React Chrome æ’ä»¶, å¤šé¡µé¢ Vite é¡¹ç›®]
draft: false
summary: å‰é¢æˆ‘æœ‰è®²åˆ°æƒ³è‡ªå·±å†™ä¸€ä¸ªå¾®ä¿¡å…¬ä¼—å·çš„ç¼–è¾‘å·¥å…·ï¼Œå°±èŠ±äº†ç‚¹æ—¶é—´å†™äº†ä¸€ä¸ªç”¨ Markdown ç¼–è¾‘å¾®ä¿¡å…¬ä¼—å·çš„æµè§ˆå™¨æ’ä»¶ MP Editorã€‚ç°åœ¨å°±ä»¥ MP Editor ä¸ºä¾‹ï¼Œä»‹ç»ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨ Vite + React å¼€å‘ä¸€ä¸ªChromeæ’ä»¶ã€‚
description: æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ Vite å’Œ React å¼€å‘ Chrome æ’ä»¶ï¼Œä»¥ MP Editor ä¸ºä¾‹ï¼Œè®²è§£ä»åˆå§‹åŒ–é¡¹ç›®åˆ°é…ç½® manifest.json æ–‡ä»¶çš„å®Œæ•´æµç¨‹ã€‚ä½ å°†å­¦ä¼šæ­å»ºå¤šé¡µé¢ç»“æ„ã€ç¼–å†™ background å’Œ content è„šæœ¬ã€å®ç°åŸºæœ¬é¡µé¢äº¤äº’ã€‚æ–‡ä¸­æä¾›äº†å®Œæ•´çš„ä»£ç ç¤ºä¾‹å’Œç›®å½•ç»“æ„ï¼Œè®©ä½ æ— éœ€ä»é›¶å¼€å§‹å³å¯é«˜æ•ˆå¼€å‘å±äºè‡ªå·±çš„ Chrome æ‰©å±•æ’ä»¶ã€‚
---

## å‰è¨€

&emsp;&emsp;å‰é¢æˆ‘æœ‰è®²åˆ°æƒ³è‡ªå·±å†™ä¸€ä¸ªå¾®ä¿¡å…¬ä¼—å·çš„ç¼–è¾‘å·¥å…·ï¼Œå°±èŠ±äº†ç‚¹æ—¶é—´å†™äº†ä¸€ä¸ªç”¨ Markdown ç¼–è¾‘å¾®ä¿¡å…¬ä¼—å·çš„æµè§ˆå™¨æ’ä»¶[MP Editor](https://github.com/h-yw/mp-editor)ã€‚ç°åœ¨å°±ä»¥ [MP Editor](https://github.com/h-yw/mp-editor) ä¸ºä¾‹ï¼Œä»‹ç»ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨ `Vite + React` å¼€å‘ä¸€ä¸ªChromeæ’ä»¶ã€‚

<TOCInline toc={props.toc} exclude="Overview" toHeading={3} />

## å‡†å¤‡å·¥ä½œ

&emsp;&emsp;æˆ‘ä»¬å…ˆåˆ›å»ºåŸºæœ¬çš„é¡¹ç›®ä¾›åç»­å¼€å‘ã€‚è¿™é‡Œä¼šä½¿ç”¨ [vite-muilt-page-template](https://github.com/h-yw/vite-muilt-page-template.git)ã€‚è¿™æ˜¯åœ¨åš `mp editor` æ—¶æŠ½ç¦»å‡ºçš„ä¸€ä¸ªåŸºäºviteçš„å¤šé¡µé¢é¡¹ç›®æ¨¡æ¿ï¼Œä¾›ä¹‹ååšé¡¹ç›®æ—¶å‚è€ƒä½¿ç”¨ã€‚

1. ä¸‹è½½ [vite-muilt-page-template](https://github.com/h-yw/vite-muilt-page-template.git)

```bash
git clone --depth 1 https://github.com/h-yw/vite-muilt-page-template.git  chrome-extension-template
```

2. å®‰è£…ä¾èµ–åŒ…

```bash
yarn install
```

## ç›®å½•ç»“æ„

åŸºæœ¬çš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š

```bash
.
â”œâ”€â”€ README.md
â”œâ”€â”€ index.html htmlæ¨¡æ¿æ–‡ä»¶
â”œâ”€â”€ package.json
â”œâ”€â”€ vite.config.ts
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ .gitignore
â”œâ”€â”€ html ç”Ÿæˆhtmlé¡µé¢å…¥å£
â”œâ”€â”€ public
â”œâ”€â”€ scripts
â”‚Â Â  â””â”€â”€ pages.js å¤šé¡µé¢ç›¸å…³å†…å®¹è„šæœ¬
â”œâ”€â”€ public
â””â”€â”€ src
    â”œâ”€â”€ assets
    â”‚Â Â  â””â”€â”€ logo.png
    â”œâ”€â”€ entries
    â”‚Â Â  â”œâ”€â”€ index.tsx
    â”‚Â Â  â””â”€â”€ index
    â”‚Â Â      â”œâ”€â”€ index.less
    â”‚Â Â      â””â”€â”€ index.tsx
    â””â”€â”€ vite-env.d.ts

```

## å…·ä½“å®ç°

### manifest.jsoné…ç½®æ–‡ä»¶

&emsp;&emsp;`manifest.json` æ–‡ä»¶æ˜¯ Chrome æ’ä»¶å¿…è¦çš„é…ç½®æ–‡ä»¶ï¼Œå®ƒå®šä¹‰äº†æ’ä»¶çš„åŠŸèƒ½ã€å›¾æ ‡ã€æƒé™ç­‰ã€‚

&emsp;&emsp;åœ¨ `public` ç›®å½•ä¸‹åˆ›å»º `manifest.json` æ–‡ä»¶ã€‚å†…å®¹ç¤ºä¾‹å¦‚ä¸‹ï¼š

```json
{
  "manifest_version": 3,
  "name": "MP Editor",
  "short_name": "MP Editor",
  "author": "houyw",
  "version": "1.0.0",
  "description": "å…¬ä¼—å·markdownç¼–è¾‘å™¨",
  "homepage_url": "https://github.com/h-yw/mp-editor",
  // å›¾æ ‡, èµ„æºåœ¨æ„å»ºç»“æœç›®å½•ä¸‹çš„imagesç›®å½•ä¸­
  "icons": {
    "16": "images/mp_16x16.png",
    "32": "images/mp_32x32.png",
    "48": "images/mp_48x48.png",
    "128": "images/mp_128x128.png"
  },
  // popupå½¢å¼çš„é¡µé¢ï¼Œç‚¹å‡»æ‰©å±•å›¾æ ‡åå¼¹å‡ºçš„é¡µé¢
  // æ„å»ºåçš„æ–‡ä»¶åœ¨distç›®å½•ä¸­htmlç›®å½•ä¸‹ï¼Œ
  "action": {
    "default_popup": "html/welcome.html",
    "default_title": "å…¬ä¼—å·Markdownç¼–è¾‘å™¨"
  },
  //  è¿è¡Œåœ¨æ’ä»¶çº¿ç¨‹ä¸­çš„jsæ–‡ä»¶ï¼Œæ— æ³•è®¿é—®é¡µé¢DOMç­‰å†…å®¹
  "background": {
    "service_worker": "assets/sw.js"
  },
  // æ³¨å…¥åˆ°é¡µé¢çš„jsè„šæœ¬ï¼Œå¯ä»¥è®¿é—®DOMç­‰
  "content_scripts": [
    {
      "matches": ["*://mp.weixin.qq.com/*"],
      "js": ["assets/mp.js"],
      "run_at": "document_end"
    }
  ],
  // ä¾§è¾¹æ 
  "side_panel": {
    "default_path": "html/side-panel.html"
  },
  // æƒé™æ§åˆ¶
  "permissions": [
    "sidePanel",
    "tabs",
    "activeTab",
    "scripting",
    "downloads",
    "storage",
    "clipboardRead"
  ],
  "host_permissions": ["<all_urls>"],
  "web_accessible_resources": [
    {
      "resources": ["assets/onig.wasm"],
      "matches": ["*://mp.weixin.qq.com/*"]
    }
  ],
  // å®‰å…¨ç­–ç•¥
  "content_security_policy": {
    "extension_pages": "script-src 'self' 'wasm-unsafe-eval'; object-src 'self';",
    "sandbox": "sandbox allow-scripts allow-forms allow-popups allow-modals; script-src 'self' 'unsafe-inline' 'unsafe-eval'; child-src 'self';"
  }
}
```

### backgroundè„šæœ¬å’Œcontentè„šæœ¬

1. åœ¨ `src` ä¸‹åˆ›å»º `feature` ç›®å½•
2. åœ¨ `feature` ä¸‹æ–°å»º `sw.ts` æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶ä¸»è¦ç”¨äºä¸€äº›æ’ä»¶çš„åå°åŠŸèƒ½ï¼Œä¾‹å¦‚ç›‘å¬æ ‡ç­¾åˆ‡æ¢ç­‰ã€‚
3. åœ¨ `feature` ä¸‹æ–°å»º `mp.ts` æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶ä¸»è¦ç”¨äºæ³¨å…¥åˆ°é¡µé¢å†…ã€‚

### vite.config.tsé…ç½®æ–‡ä»¶

é¦–å…ˆåœ¨ `scripts/pages.ts` ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š

```ts
export const featurePath = path.join(rootPath, 'src/feature')
export const featureMap = getDirMap('src/feature/*.ts', '.ts')
```

æ›´æ–° `vite.config.ts` çš„ `build.rollupOptions.input` é…ç½®å¦‚ä¸‹ã€‚

```ts
export default defineConfig({
  build: {
    rollupOptions: {
      input: { ...input, ...featureMap },
    },
  },
})
```

### æ–°å»ºé¡µé¢

1. åœ¨ `src/entries/welcome` ä¸‹æ–°å»º `index.tsx` æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```tsx
import React from 'react'

export default function Welcome() {
  return <div>æ¬¢è¿ä½¿ç”¨</div>
}
```

2. åœ¨ `src/entries/welcome.tsx` ä¸­å¼•å…¥ `Welcome` ç»„ä»¶ï¼Œå¹¶æ¸²æŸ“åˆ°é¡µé¢ä¸­ã€‚

```tsx
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import Welcome from './welcome/index'

const root = document.getElementById('root')!
createRoot(root).render(
  <StrictMode>
    <Welcome />
  </StrictMode>
)
```

## æ€»ç»“

&emsp;&emsp;å¼€å‘ä¸€ä¸ªChromeæ’ä»¶çš„æ‰€éœ€å†…å®¹å¤§æ¦‚å°±è¿™äº›äº†ã€‚è¿™é‡Œæœ‰äº›å†…å®¹å¹¶æ²¡æœ‰è¯¦ç»†å»è®²ï¼Œä»…ä»…æ˜¯æ­å»ºèµ·äº†å¼€å‘Chromeæ’ä»¶çš„åŸºæœ¬ç¯å¢ƒã€‚å½“ç„¶ï¼Œä½ ä¾ç„¶å¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šå¿«é€Ÿå¼€å‘ä½ è‡ªå·±çš„Chromeæ’ä»¶ï¼Œä¸å¿…ä»0å¼€å§‹ğŸ˜„ã€‚

## ä¸€äº›å‚è€ƒ

Chromeæ’ä»¶å¼€å‘æ–‡æ¡£ï¼š [https://developer.chrome.com/docs/extensions/](https://developer.chrome.com/docs/extensions/)
